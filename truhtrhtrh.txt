
local DISCORD_CODE = "KazG3SxY8N"
local LUARMOR_URL  = "https://api.luarmor.net/files/v3/loaders/931b47780b67616011da2614ce91ad19.lua"
local GET_KEY_URL  = "https://ads.luarmor.net/get_key?for=goose_hub-tnwSKKlblAKT"

-- === persistence helpers ===
local FOLDER, FILE = "AccessPanel", "AccessPanel/last_key.txt"
local has_fs = typeof(isfile)=="function" and typeof(writefile)=="function" and typeof(readfile)=="function"
local has_mkdir = typeof(makefolder)=="function"

local function load_saved_key()
	if has_fs and isfile(FILE) then
		local ok, data = pcall(readfile, FILE)
		if ok and data and #data > 0 then return data end
	end
	return rawget(getgenv(), "_AP_last_key")
end

local function save_key(k)
	if type(k) ~= "string" or #k == 0 then return end
	if has_fs then
		if has_mkdir then pcall(makefolder, FOLDER) end
		pcall(writefile, FILE, k)
	end
	getgenv()._AP_last_key = k
end

-- === GUI base ===
local CoreGui = game:GetService("CoreGui")
local gui = Instance.new("ScreenGui")
gui.Name = "AccessPanel"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Parent = CoreGui

local function rounded(obj, r)
	local uic = Instance.new("UICorner")
	uic.CornerRadius = UDim.new(0, r or 8)
	uic.Parent = obj
end

local function mkButton(parent, text, size, pos)
	local b = Instance.new("TextButton")
	b.Size = size
	b.Position = pos
	b.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	b.TextColor3 = Color3.fromRGB(255, 255, 255)
	b.Font = Enum.Font.SourceSansBold
	b.TextSize = 18
	b.Text = text
	b.AutoButtonColor = true
	b.Parent = parent
	rounded(b, 8)
	return b
end

local function destroy_all()
	for _,v in ipairs({
		CoreGui:FindFirstChild("AccessPanel"),
		game.Players.LocalPlayer:FindFirstChild("PlayerGui") and game.Players.LocalPlayer.PlayerGui:FindFirstChild("AccessPanel")
	}) do
		if v then pcall(function() v:Destroy() end) end
	end
end

-- === main frame ===
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 340, 0, 250) -- taller to fit the extra button
frame.Position = UDim2.new(0.5, -170, 0.5, -125)
frame.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
frame.BorderSizePixel = 0
frame.Parent = gui
rounded(frame, 10)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -20, 0, 40)
title.Position = UDim2.new(0, 10, 0, 6)
title.BackgroundTransparency = 1
title.Text = "Access Panel"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Parent = frame

-- input row
local input = Instance.new("TextBox")
input.Size = UDim2.new(1, -40, 0, 36)
input.Position = UDim2.new(0, 20, 0, 56)
input.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
input.TextColor3 = Color3.fromRGB(255, 255, 255)
input.Font = Enum.Font.SourceSans
input.TextSize = 20
input.ClearTextOnFocus = false
input.Text = "" -- no placeholder
input.Parent = frame
rounded(input, 8)

local submit = mkButton(frame, "Submit",   UDim2.new(1, -40, 0, 36), UDim2.new(0, 20, 0, 100))
submit.BackgroundColor3 = Color3.fromRGB(70, 130, 180)

local getKeyBtn = mkButton(frame, "Get Key", UDim2.new(1, -40, 0, 36), UDim2.new(0, 20, 0, 144))

local discordBtn = mkButton(frame, "Join our Discord", UDim2.new(1, -40, 0, 36), UDim2.new(0, 20, 0, 188))

local note = Instance.new("TextLabel")
note.Size = UDim2.new(1, -20, 0, 26)
note.Position = UDim2.new(0, 10, 1, -28)
note.BackgroundTransparency = 1
note.Text = "Make a ticket for a free 30m trial key."
note.Font = Enum.Font.SourceSansItalic
note.TextSize = 15
note.TextWrapped = true
note.TextColor3 = Color3.fromRGB(200, 200, 200)
note.Parent = frame

-- === "Use last key?" prompt ===
local savedKey = load_saved_key()
local reusePrompt

if type(savedKey) == "string" and #savedKey > 0 then
	reusePrompt = Instance.new("Frame")
	reusePrompt.Size = UDim2.new(1, -40, 0, 90)
	reusePrompt.Position = UDim2.new(0, 20, 0, 56)
	reusePrompt.BackgroundColor3 = Color3.fromRGB(36, 36, 36)
	reusePrompt.BorderSizePixel = 0
	reusePrompt.Parent = frame
	rounded(reusePrompt, 10)

	local msg = Instance.new("TextLabel")
	msg.Size = UDim2.new(1, -16, 0, 40)
	msg.Position = UDim2.new(0, 8, 0, 8)
	msg.BackgroundTransparency = 1
	msg.Text = "Use last key?"
	msg.Font = Enum.Font.SourceSans
	msg.TextSize = 20
	msg.TextColor3 = Color3.fromRGB(255, 255, 255)
	msg.Parent = reusePrompt

	local yes = mkButton(reusePrompt, "Yes", UDim2.new(0.5, -6, 0, 34), UDim2.new(0, 0, 0, 50))
	yes.BackgroundColor3 = Color3.fromRGB(65, 145, 90)

	local no  = mkButton(reusePrompt, "No",  UDim2.new(0.5, -6, 0, 34), UDim2.new(0.5, 6, 0, 50))
	no.BackgroundColor3 = Color3.fromRGB(145, 65, 65)

	-- Hide normal input/submit until decision. Keep Get Key visible.
	input.Visible = false
	submit.Visible = false
	getKeyBtn.Position = UDim2.new(0, 20, 0, 156)
	discordBtn.Position = UDim2.new(0, 20, 0, 200)

	yes.MouseButton1Click:Connect(function()
		local key = savedKey
		save_key(key)
		destroy_all()
		task.defer(function()
			getgenv().script_key = key
			local ok, err = pcall(function()
				loadstring(game:HttpGet(LUARMOR_URL))()
			end)
			if not ok then warn("[AccessPanel] Loader error:", err) end
		end)
	end)

	no.MouseButton1Click:Connect(function()
		reusePrompt:Destroy()
		input.Visible = true
		submit.Visible = true
		getKeyBtn.Position = UDim2.new(0, 20, 0, 144)
		discordBtn.Position = UDim2.new(0, 20, 0, 188)
	end)
end

-- === interactions ===
local submitting = false

submit.MouseButton1Click:Connect(function()
	if submitting then return end
	submitting = true

	local key = input.Text
	if key == "" then
		title.Text = "Please enter a key!"
		title.TextColor3 = Color3.fromRGB(255, 100, 100)
		submitting = false
		return
	end

	save_key(key)
	destroy_all()

	task.defer(function()
		getgenv().script_key = key
		local ok, err = pcall(function()
			loadstring(game:HttpGet(LUARMOR_URL))()
		end)
		if not ok then warn("[AccessPanel] Loader error:", err) end
	end)
end)

getKeyBtn.MouseButton1Click:Connect(function()
	if setclipboard then setclipboard(GET_KEY_URL) end
	title.Text = "Key link copied!"
	title.TextColor3 = Color3.fromRGB(100, 255, 100)
end)

discordBtn.MouseButton1Click:Connect(function()
	if setclipboard then setclipboard("https://discord.gg/" .. DISCORD_CODE) end
	title.Text = "Discord invite copied!"
	title.TextColor3 = Color3.fromRGB(100, 255, 100)
end)
